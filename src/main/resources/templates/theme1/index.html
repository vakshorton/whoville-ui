<!DOCTYPE html>
<html>

<head>

	<meta charset="utf-8"></meta>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>

    <title>Whoville Platform Service</title>

    <link href="theme1/css/bootstrap.min.css" rel="stylesheet"></link>
    <link href="theme1/font-awesome/css/font-awesome.css" rel="stylesheet"></link>

    <link href="theme1/css/animate.css" rel="stylesheet"></link>
    <link href="theme1/css/style.css" rel="stylesheet"></link>
	
	<link href="theme1/css/bootstrap.min.css" rel="stylesheet"></link>
    <link href="theme1/font-awesome/css/font-awesome.css" rel="stylesheet"></link>
	<link href="theme1/css/plugins/jsTree/style.min.css" rel="stylesheet"></link>
    <link href="theme1/css/plugins/switchery/switchery.css" rel="stylesheet"></link>
    <link href="theme1/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet"></link>
    <link href="theme1/css/plugins/datapicker/datepicker3.css" rel="stylesheet">
    <link href="theme1/css/animate.css" rel="stylesheet"></link>
    <link href="theme1/css/style.css" rel="stylesheet"></link>
    <link rel="stylesheet" href="theme1/js/jquery-ui-1.12.1/jquery-ui.css"></link>
    

</head>

<style>
  
    #autocomplete {
	background-image: url('theme1/img/searchicon.png'); /* Add a search icon to input */
    background-position: 10px 8px; /* Position the search icon */
    background-repeat: no-repeat; /* Do not repeat the icon image */
      font-size: 18px;
 	 padding: 6px 6px 6px 40px;
  	/*border: 1px solid #ddd;*/
  	margin-bottom: 12px;
  	margin:0 auto;
  	height:40px;
	}
    
    .jstree-open > .jstree-anchor > .fa-folder:before {
        content: "\f07c";
    }

    .jstree-default .jstree-icon.none {
        width: 0;
    }

</style>

<body onLoad="refreshClusters()">

<!-- Mainly scripts -->
<script src="theme1/js/jquery-3.1.1.min.js"></script>
<script src="theme1/js/bootstrap.min.js"></script>
<script src="theme1/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="theme1/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Mainly scripts -->
<script src="theme1/js/jquery-3.1.1.min.js"></script>
<script src="theme1/js/bootstrap.min.js"></script>
<script src="theme1/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="theme1/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="theme1/js/inspinia.js"></script>
<script src="theme1/js/plugins/pace/pace.min.js"></script>
<script src="theme1/js/plugins/jsTree/jstree.min.js"></script>

<!-- Switchery -->
<script src="theme1/js/plugins/switchery/switchery.js"></script>
<script src="theme1/js/jquery-ui-1.12.1/jquery-ui.js"></script><!-- Data picker -->
<script src="theme1/js/plugins/datapicker/bootstrap-datepicker.js"></script>

<!-- Custom and plugin javascript -->
<script src="theme1/js/inspinia.js"></script>
<script src="theme1/js/plugins/pace/pace.min.js"></script>

<div id="wrapper">

     <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                <div _ngcontent-c1="" class="logo">
                		<a href="#" id="cb_url" onClick="window.open(cbUrl, '_blank');">
        					<img _ngcontent-c1="" alt="Hortonworks Cloudbreak" src="./img/cb_logo.png" style="float: left"title="Whoville Demo Platform">
        					<div _ngcontent-c1="">WHOVILLE</div>
        					<div _ngcontent-c1="">PLATFORM</div>
        					<div _ngcontent-c1="">SERVICE</div>
    					</a>
				</div>
                <li class="active">
                    <a href="#" onclick="exploreCatalog()"><i class="fa fa-book"></i> <span class="nav-label">Browse Catalog</span></a>
                </li>
                <li class="active">
                    <a href="#" onclick="displayWizard()"><i class="fa fa-server"></i> <span class="nav-label">Provision Demo</span></a>
                </li>
               <!--  <li class="active">
                    <a href="index.html" onclick="refreshArtifacts()"><i class="fa fa-history"></i> <span class="nav-label">Synch Artifacts</span></a>
                </li> -->
            </ul>
        </div>
    </nav>

    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top white-bg" role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                   <!--  <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a> -->
                </div>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <a href="#">
                            <i class="fa fa-sign-out"></i> Log out
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="row">
				<div id="catalog_search" class="col-lg-3" style="display: none">
            			<div class="ibox float-e-margins">
                			<div class="ibox-title">
                    			<div class="ibox-tools">
                        			<a class="collapse-link">
                            			<i class="fa fa-chevron-up"></i>
                        			</a>
                    			</div>
                			</div>
                			<div class="ibox-title">
                   			<input value="" style="box-shadow:inset 0 0 4px #eee; width:220px; margin:0; padding:6px 12px; border-radius:4px; border:1px solid silver; font-size:1.1em;" id="demo_q" placeholder="Search" type="text">
                			</div>
                			<div class="ibox-content">
							<div id="using_json"></div>
                			</div>
					</div>
				</div>
    				<div id="atlas" class="col-lg-9">	
    					<div id="atlas_viewer_container" class="ibox float-e-margins" style="display: none">
    						<div id="atlas_viewer" class="ibox-content" style="height: 300px;"></div>
    					</div>
    				</div>
   				<div id="wizard" class="col-lg-9">	
    					<div id="form_container" class="ibox float-e-margins" style="display: none">
    						<div class="ibox-content" style="height: 325px;">
    							<form id="main_form">
    							<h3 class="form-group-title">General Configuration</h3>
            						<div class="form-group">
                  						<label class="col-sm-3 control-label" for="selecthdpVersion">Target Cloud Platform</label>
                  						<div class="col-sm-9">
                     						<select class="form-control ng-pristine ng-untouched ng-not-empty ng-valid ng-valid-required" id="platform" onChange="populateOptions()" required disabled>
                        						<option value="connected-platform" selected="selected">Select Target Cloud</option>
                     						</select>
                  						</div>
                					</div>
    								<div class="form-group required" id="general_info_body">
                  					<!-- <label class="col-sm-3 control-label" for="clusterName">Cluster Name</label>
                  					<div class="col-sm-9">
                     					<input type="text" class="form-control red-placeholder ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required ng-valid-pattern ng-valid-minlength ng-valid-maxlength alert-danger" disabled id="cluster_name" name="clusterName" placeholder="(REQUIRED) Enter cluster name (min 5, max 20, must start with a letter, accepted chars: a-z, 0-9, -)" style=" background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">
                  					</div> -->
                  					<div class="form-group">
                  						<label class="col-sm-3 control-label" for="selecthdpVersion">Cluster Type</label>
                  						<div class="col-sm-9">
                     						<select class="form-control ng-pristine ng-untouched ng-not-empty ng-valid ng-valid-required" id="cluster_type" required>
                     						</select>
                  						</div>
                  					</div>	
								</div>    				
    								<!-- <h3 class="form-group-title">Hardware &amp; Storage</h3>
    			 					<div class="form-group">
                  					<label class="col-sm-3 control-label" for="selecthdpVersion">Instance Type</label>
                  					<div class="col-sm-9">
                     					<select class="form-control ng-pristine ng-untouched ng-not-empty ng-valid ng-valid-required" id="templates" required disabled>
                     					</select>
                  					</div>
                  				</div> -->
								<h3 class="form-group-title">Security</h3>
    								<div class="form-group">
                  					<label class="col-sm-3 control-label" for="selecthdpVersion">Credentials</label>
                  					<div class="col-sm-9">
                     					<select class="form-control ng-pristine ng-untouched ng-not-empty ng-valid ng-valid-required" id="credentials" required disabled></select>	
                  					</div>
                  				</div>
    							</form>
    							<div id="button_create_cluster">
    								<button id="create_cluster" disabled onclick="createCluster(false)" class="btn btn-default" style="border-color: #456b7e; color: #456b7e;">Create Cluster</button>
    							</div>
    						</div>
					</div>	 	
    				</div>
    				<div id="ephemerial_wizard" class="col-lg-9">	
    					<div id="ephemeral_form_container" class="ibox float-e-margins" style="display: none">
    						<div class="ibox-content" style="height: 350px;">
    							<form id="ephemeral_main_form" >
    							<h3 class="form-group-title">General Configuration</h3>
            						<div class="form-group">
                  						<label class="col-sm-3 control-label" for="selecthdpVersion">Target Cloud Platform</label>
                  						<div class="col-sm-9">
                     						<select class="form-control ng-pristine ng-untouched ng-not-empty ng-valid ng-valid-required" id="ephemeral_platform" onChange="populateEphemeralClusterOptions()" required disabled>
                        							<option value="" selected="selected">Select Target Cloud</option>
                     						</select>
                  						</div>
                					</div>

                  				<input type="hidden" id="dps_ip" name="dps_ip" value="false" class="form-control red-placeholder ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required ng-valid-pattern ng-valid-minlength ng-valid-maxlength alert-danger" disabled style=" background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">
                  				<input type="hidden" id="dps_status" name="dps_status" value="false" class="form-control red-placeholder ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required ng-valid-pattern ng-valid-minlength ng-valid-maxlength alert-danger" disabled style=" background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">
                  				<input type="hidden" id="dps_cluster_name" name="dps_cluster_name" value="false" class="form-control red-placeholder ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required ng-valid-pattern ng-valid-minlength ng-valid-maxlength alert-danger" disabled style=" background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">
                  				<input type="hidden" id="shared_services_status" name="shared_services_status" value="false" class="form-control red-placeholder ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required ng-valid-pattern ng-valid-minlength ng-valid-maxlength alert-danger" disabled style=" background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">
                  				<input type="hidden" id="shared_services_cluster_name" name="shared_services_cluster_name" value="false" class="form-control red-placeholder ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required ng-valid-pattern ng-valid-minlength ng-valid-maxlength alert-danger" disabled style=" background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">
                  				<input type="hidden" id="ephemeral_replication_source_clusterId" name="replicationSourceClusterId" class="form-control red-placeholder ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required ng-valid-pattern ng-valid-minlength ng-valid-maxlength alert-danger" disabled style=" background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">
                  				<input type="hidden" id="ephemeral_replication_source_clusterName" name="replicationSourceClusterName" class="form-control red-placeholder ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required ng-valid-pattern ng-valid-minlength ng-valid-maxlength alert-danger" disabled style=" background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">	
                  				<input type="hidden" id="ephemeral_replication_source_dataset_name" name="replicationDatasetName" class="form-control red-placeholder ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required ng-valid-pattern ng-valid-minlength ng-valid-maxlength alert-danger" disabled style=" background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">		
    								<div class="form-group required" id="ephemeral_general_info_body">
                  					<!-- <label class="col-sm-3 control-label" for="clusterName">Cluster Name</label>
                  					<div class="col-sm-9">
                     					<input type="text" id="ephemeral_cluster_name" name="clusterName" class="form-control red-placeholder ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required ng-valid-pattern ng-valid-minlength ng-valid-maxlength alert-danger" disabled style=" background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">
                  					</div>
                  				</div>	 -->
                  				<!-- <div class="form-group"> -->
									<label class="col-sm-3 control-label" for="selecthdpVersion">Cluster Type</label>
                  					<div class="col-sm-9">
                     					<select class="form-control ng-pristine ng-untouched ng-not-empty ng-valid ng-valid-required" id="ephemeral_cluster_type" required disabled>
                        						<option value=0 selected="selected">No ephemeral types defined in resources path...</option>
                     					</select>
                  					</div>
                  				</div>			
    								<!-- <h3 class="form-group-title">Hardware &amp; Storage</h3>
    			 					<div class="form-group">
                  					<label class="col-sm-3 control-label" for="selecthdpVersion">Instance Type</label>
                  					<div class="col-sm-9">
                     					<select class="form-control ng-pristine ng-untouched ng-not-empty ng-valid ng-valid-required" id="ephemeral_templates" required disabled></select>
                  					</div>
                  				</div> -->
								<h3 class="form-group-title">Security</h3>
    								<div class="form-group">
                  					<label class="col-sm-3 control-label" for="selecthdpVersion">Credentials</label>
                  					<div class="col-sm-9">
                     					<select class="form-control ng-pristine ng-untouched ng-not-empty ng-valid ng-valid-required" id="ephemeral_credentials" required disabled></select>
                  					</div>
                  				</div>
    							</form>
    							<div id="button_create_cluster">
    								<button id="create_ephemeral_cluster" disabled onclick="createCluster(true)" class="btn btn-default" style="border-color: #456b7e; color: #456b7e;">Create Cluster</button>
    							</div>
    						</div>
					</div>	 	
    				</div>
			</div>
        <div class="wrapper wrapper-content animated fadeInRight">
			<div class="row cards-row"id="clusters">
			</div>
	   </div>
	</div>
</div>

<!-- Mainly scripts -->
<script src="theme1/js/jquery-3.1.1.min.js"></script>
<script src="theme1/js/bootstrap.min.js"></script>
<script src="theme1/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="theme1/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="theme1/js/inspinia.js"></script>
<script src="theme1/js/plugins/pace/pace.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="theme1/js/inspinia.js"></script>
<script src="theme1/js/plugins/pace/pace.min.js"></script>
<script src="theme1/js/plugins/jsTree/jstree.min.js"></script>

</body>
<script>

/* Global / Page level variables */
var tagsG;
var sdateG;
var edateG;
var granG = "minute";
var funcG;

var series; 
var xAxisLabels;

var tree1;
var datalakes;
var rds;
var dps;
var cbUrl;

if($('#dps_status').val)
	getFileTree()

function getFileTree(){

	$.get("/getFileTree", function(tree) {
	//$.get("/getDssCollectionsTree", function(tree) {

	tree1 = tree;
	console.log(tree);
	
	//tree1.core = { label: "Hello", url: "#hello" };
	$.extend(tree, {
		'plugins' : [ 'types', 'dnd', 'search' ],
        'types' : {
            'default' : {
                'icon' : 'fa fa-folder'
            },
            'folder' : {
                'icon' : 'fa fa-database'
            },
            "file" : {
                "icon" : "fa fa-table",
            },
            'html' : {
                'icon' : 'fa fa-file-code-o'
            },
            'svg' : {
                'icon' : 'fa fa-file-picture-o'
            },
            'css' : {
                'icon' : 'fa fa-file-code-o'
            },
            'img' : {
                'icon' : 'fa fa-file-image-o'
            },
            'js' : {
                'icon' : 'fa fa-file-text-o'
            }
        }
	});
	
	$('#using_json').on("select_node.jstree", function (e, data) { 
		console.log(e);
		console.log("node: " + data.node.text);
		console.log("selected node: " + data);
		entityFQN = data.node.id.split('*')[0];
		collectionId = data.node.id.split('*')[3];
		assetGuid = data.node.id.split('*')[2];
		entityName = data.node.text;
		sourceClusterId = entityFQN.split('@')[1];
		console.log("selected node: " + entityFQN + " " + collectionId + " " + assetGuid);
		displayDssEntity(collectionId, assetGuid)
		//displayEntity(entityFQN, sourceClusterId)
		//var elem =document.getElementById('checkbox0');
		//getTsFunction(elem, 0, "sum"); //  "2017-04-23_00:00:00", "2017-05-03_00:00:00", "sum", "minute");
	}); 
	
	 $('#using_json').jstree(tree);
});
}

function displayWizard() {
	var form = document.getElementById('form_container')
	//console.log("RDS: " + rds['AWS']['hive'])
	//console.log("Datalakes: " + datalakes)
	if (form.style.display == 'none')
		form.style.display = 'block'
	else
		form.style.display = 'none'
	
	populateOptions()	
}

function displayEphemeralWizard(sourceClusterName, targetBucket, replicationSourceClusterId, replicationSourceDatasetName, isTrueEphemeral) {
	var form = document.getElementById('ephemeral_form_container')
	
	if (form.style.display == 'none')
		form.style.display = 'block'
	else
		form.style.display = 'none'
	
	
	var url = "/getCredentials";
	console.log(url);
	
	$.get(url , function(data) {
		console.log(data);
		
		clearSelect(document.getElementById('ephemeral_platform'))
		for (var key in data) {
			if (data.hasOwnProperty(key)) {
			    console.log(key + " -> " + data[key]);
			    option = document.createElement('option')
			    option.text = data['platform'];
			    option.value = data['platform'];
			    document.getElementById('ephemeral_platform').add(option)
			}
		}
		
		clearSelect(document.getElementById('ephemeral_credentials'))
		for (var key in data) {
			if (data.hasOwnProperty(key)) {
			    console.log(key + " -> " + data[key]);
			    option = document.createElement('option')
			    option.text = data['name'];
			    option.value = data['name'];
			    document.getElementById('ephemeral_credentials').add(option)
			}
		}
		
	});	
			
	//document.getElementById('ephemeral_target_bucket').value = targetBucket
	document.getElementById('ephemeral_replication_source_clusterId').value = replicationSourceClusterId
	document.getElementById('ephemeral_replication_source_clusterName').value = sourceClusterName
	document.getElementById('ephemeral_replication_source_dataset_name').value = replicationSourceDatasetName
	//document.getElementById("ephemeral_cluster_name").value = "ephemeral"+Math.floor((Math.random() * 10000) + 1)
	
	if(isTrueEphemeral){
		document.getElementById('ephemeral_cluster_type').value = 'ephemeral' 
	}else{
		document.getElementById('ephemeral_cluster_type').value = 'semi-ephemeral'
	}
	
	populateOptions()
}

function exploreCatalog() {
	var form = document.getElementById('atlas_viewer_container')
	
	if (form.style.display == 'none')
		form.style.display = 'block'
	else
		form.style.display = 'none'
		
	var form = document.getElementById('catalog_search')
			
	if (form.style.display == 'none'){
		form.style.display = 'block'
		refreshCatalog()
	}else{
		form.style.display = 'none'
	}
}

function refreshCatalog(){
	//var url = "/refreshCatalog";
	//$.get(url , function() {});
	
	getFileTree()
}

function displayDssEntity(collectionId, assetGuid) {
var form = document.getElementById('atlas_viewer_container')
	
	if (form.style.display == 'none')
		form.style.display = 'block'
	
	var url = "/getDssEntity?collectionId="+collectionId+"&assetGuid="+assetGuid
	
	var name = ""
	var qualifiedName = ""
	var outputFormat = ""
	var tableLocation = ""
    var targetBucket = ""
	var lastAccess = ""
			
	$.get(url , function(data) {
		console.log(data);
		
		name = data.entity.attributes.name
		qualifiedName = data.entity.attributes.qualifiedName
		sdGuid = data.entity.attributes.sd.guid
		outputFormat = data.referredEntities[sdGuid].attributes.outputFormat
	    tableLocation = data.referredEntities[sdGuid].attributes.location
		lastAccess = data.entity.attributes.lastAccessTime
		targetBucket = tableLocation.replace('/'+name, '')
		console.log(qualifiedName.split('.'))
		sourceDatasetName = qualifiedName.split('.')[0]
		sourceDatasetClusterName = data.clusterName
		console.log(sourceDatasetName)
		atlasViewerHtml = '<div>'+
		'<b>Name:</b> ' +name+'<br>'+
		'<b>qualifiedName:</b> '+qualifiedName+'<br>'+
		'<b>outputFormat:</b> '+outputFormat+'<br>'+
	    '<b>location:</b> '+tableLocation+'<br>'+
		'<b>createTime:</b> '+lastAccess + '<br><br>'+
		'<table>'+
		'<tr><th>Column Name</th><th>Column Type</th></tr>'
		for (var i = 0; i < data.entity.attributes.columns.length; i++) {
			currColumnGuid = data.entity.attributes.columns[i].guid
			currColumnName = data.referredEntities[currColumnGuid].attributes.name
			currColumnType = data.referredEntities[currColumnGuid].attributes.type
			atlasViewerHtml = atlasViewerHtml+'<tr><td>'+currColumnName+'</td><td>'+currColumnType+'</td></tr>'
		}
		
		atlasViewerHtml = atlasViewerHtml + '<tr></table></div>'
		if(sourceDatasetClusterName != document.getElementById('shared_services_cluster_name').value){
			atlasViewerHtml = atlasViewerHtml + '<div style="float: right;">'
										 + '		<button id="temp_workspace_button" onclick="displayEphemeralWizard(\''+sourceDatasetClusterName+'\',\''+targetBucket+'\',\''+sourceClusterId+'\',\''+sourceDatasetName+'\', false)" class="btn btn-default" style="border-color: #456b7e; color: #456b7e;">'
										 + '			Replicate Workspace'
										 + '		</button>'
										 + '</div>'
		}								 
		if(sourceDatasetClusterName == document.getElementById('shared_services_cluster_name').value){
			atlasViewerHtml = atlasViewerHtml + '<div style="float: right;">'
											 + '		<button id="access_dataset_button" onclick="displayEphemeralWizard(\''+sourceDatasetClusterName+'\',\''+targetBucket+'\',\''+sourceClusterId+'\',\''+sourceDatasetName+'\', true)" class="btn btn-default" style="border-color: #456b7e; color: #456b7e;">'
											 + '			Ephemeral Workspace'
											 + '		</button>'
											 + '</div>'
		}
		document.getElementById('atlas_viewer').innerHTML = atlasViewerHtml;
	});
}

function displayEntity(entityName, sourceClusterId) {
	var form = document.getElementById('atlas_viewer_container')
	
	if (form.style.display == 'none')
		form.style.display = 'block'
	
	var url = "/getAtlasEntity?entityName='"+entityName+"'"
	
	var name = ""
	var qualifiedName = ""
	var outputFormat = ""
	var tableLocation = ""
    var targetBucket = ""
	var lastAccess = ""
			
	$.get(url , function(data) {
		console.log(data);
		name = data.name
		qualifiedName = data.qualifiedName
		outputFormat = data.sd.outputFormat
	    tableLocation = data.sd.location
		lastAccess = data.lastAccessTime
		targetBucket = tableLocation.replace('/'+name, '')
		console.log(qualifiedName.split('.'))
		sourceDatasetName = qualifiedName.split('.')[0]
		sourceDatasetClusterName = qualifiedName.split('*')[1]
		console.log(sourceDatasetName)
		atlasViewerHtml = '<div>'+
		'<b>Name:</b> ' +name+'<br>'+
		'<b>qualifiedName:</b> '+qualifiedName+'<br>'+
		'<b>outputFormat:</b> '+outputFormat+'<br>'+
	    '<b>location:</b> '+tableLocation+'<br>'+
		'<b>createTime:</b> '+lastAccess + '<br><br>'+
		'<table>'+
		'<tr><th>Column Name</th><th>Column Type</th></tr>'
		for (var i = 0; i < data.columns.length; i++) {
			atlasViewerHtml = atlasViewerHtml+'<tr><td>'+data.columns[i].name+'</td><td>'+data.columns[i].type+'</td></tr>'
		}
		atlasViewerHtml = atlasViewerHtml+'</table>'
										 + '</div>'
										 + '<div style="float: right;">'
										 + '		<button onclick="displayEphemeralWizard(\''+targetBucket+'\',\''+sourceClusterId+'\',\''+sourceDatasetName+'\')" class="btn btn-default" style="border-color: #456b7e; color: #456b7e;">'
										 + '			Provision Temp Workspace'
										 + '		</button>'
										 + '</div>'
		if(sourceDatasetClusterName == document.getElementById('shared_services_cluster_name').value){
		atlasViewerHtml = atlasViewerHtml + '<div style="float: right;">'
										 + '		<button onclick="displayEphemeralWizard(\''+targetBucket+'\',\''+sourceClusterId+'\',\''+sourceDatasetName+'\')" class="btn btn-default" style="border-color: #456b7e; color: #456b7e;">'
										 + '			Access Dataset'
										 + '		</button>'
										 + '</div>'
		}								 
		document.getElementById('atlas_viewer').innerHTML = atlasViewerHtml;
	});
}

function isClusterNameValid() {
	
	return true
	/*
	var clusterNameValue = document.getElementById("cluster_name").value;
	var clusterNameLength = document.getElementById("cluster_name").value.length;
	
	if (clusterNameLength >= 5 && clusterNameValue.search(/[_!@#$%^&*()]/gi) == -1){
		return true;
	}else{
		return false;
	}*/
}

function populateOptions() {
	//var platform = document.getElementById('platform').value
	
	var url = "/getMenu";
	console.log(url);
	
	$.get(url , function(data) {
		console.log(data);
		
		clearSelect(document.getElementById('cluster_type'))
		ephemeralTypeCount = 0
		for (var key in data) {
			if (data.hasOwnProperty(key)) {
			    console.log(key + " -> " + data[key]);
			    option = document.createElement('option')
			    option.text = key + " - " + data[key];
			    option.value = key;
			    document.getElementById('cluster_type').add(option)
			    if(option.value.includes('ephemeral')){
			    		if(ephemeralTypeCount == 0) {
			    			clearSelect(document.getElementById('ephemeral_cluster_type'))
			    			document.getElementById("create_ephemeral_cluster").disabled = false;
			    		}
			    		ephemeralOption = document.createElement('option')
					ephemeralOption.text = key + " - " + data[key];
			    		ephemeralOption.value = key;
			    		ephemeralTypeCount++
			    		console.log("ephemeral option - " + key + " -> " + data[key]);
			    		document.getElementById('ephemeral_cluster_type').add(ephemeralOption)
			    }
			}
		}
	});
	
	var url = "/getCredentials";
	console.log(url);
	
	$.get(url , function(data) {
		console.log(data);
		
		clearSelect(document.getElementById('platform'))
		for (var key in data) {
			if (data.hasOwnProperty(key)) {
			    console.log(key + " -> " + data[key]);
			    option = document.createElement('option')
			    option.text = data['platform'];
			    option.value = data['platform'];
			    document.getElementById('platform').add(option)
			}
		}
		
		clearSelect(document.getElementById('credentials'))
		for (var key in data) {
			if (data.hasOwnProperty(key)) {
			    console.log(key + " -> " + data[key]);
			    option = document.createElement('option')
			    option.text = data['name'];
			    option.value = data['name'];
			    document.getElementById('credentials').add(option)
			}
		}
		
	});
	
	document.getElementById("cluster_type").disabled = false;
	document.getElementById("create_cluster").disabled = false;
}

function refreshClusters(){
	setTimeout(refreshClusters, 300000)
	var url = "/refreshAllClusters";
	console.log(url);
	var isSharedServices = false
	$.get(url, function(data) {
		console.log(data)

		$('.cluster').remove();
		for (var key in data) {
			if(key=='cbIp'){
				cbUrl = 'https://'+data[key]
			}else{
				var clusterId = key
				var clusterName = data[key].clusterName
				var clusterType = data[key].clusterType
				var platform = data[key].platform
				var templateName = data[key].templateName
				var clusterAmbariIp = data[key].clusterAmbariIp
				var clusterStatus = data[key].clusterStatus 
				var gateway = null
				if(data[key].gateway != null){
					gateway = data[key].gateway
				}
				console.log('Shared Services Status: ' + isSharedServices)
				if(data[key].isSharedServices){
					isSharedServices = true
					$('#shared_services_cluster_name').val(clusterName)
				}
				if(data[key].isDps){
					isDps = true
					dps = data[key].clusterAmbariIp
					$('#dps_status').val(isDps)
					$('#dps_ip').val(dps)
					$('#dps_cluster_name').val(clusterName)
				}
				paintCluster(clusterId, clusterName, clusterType, clusterStatus, platform, templateName, clusterAmbariIp, gateway)
				$('#shared_services_status').val(isSharedServices)
			}
		}
	});
	console.log('Dps Ip: ' + document.getElementById('dps_ip').value)
	console.log('Dps Cluster Name: ' + document.getElementById('dps_cluster_name').value)
	console.log('Shared Services Status: ' + document.getElementById('shared_services_status').value)
	console.log('Shared Services Cluster Name: ' + document.getElementById('shared_services_cluster_name').value)
	
	populateOptions();
}

function refreshArtifacts(){
	var url = "/refreshArtifacts";
	console.log(url);
	
	$.get(url, function() {});
}

function createCluster(isEphemeral){
	if(isEphemeral){
		var clusterName = "Pending..." //document.getElementById("ephemeral_cluster_name").value;
		var clusterType = document.getElementById("ephemeral_cluster_type").value;
		var clusterTypeName = document.getElementById("ephemeral_cluster_type").options[document.getElementById("ephemeral_cluster_type").selectedIndex].text;
		var platform = document.getElementById("ephemeral_platform").value;
		//var templateId = document.getElementById("ephemeral_templates").value;
		//var templateName = document.getElementById("ephemeral_templates").options[document.getElementById("ephemeral_templates").selectedIndex].text
		var credentialId = document.getElementById("ephemeral_credentials").value;
		//var targetBucket = document.getElementById("ephemeral_target_bucket").value;
		var sourceClusterId = document.getElementById("ephemeral_replication_source_clusterId").value;
		var sourceClusterName = document.getElementById("ephemeral_replication_source_clusterName").value;
		var sourceDatasetName = document.getElementById("ephemeral_replication_source_dataset_name").value;
		var sharedServicesIp = "place_holder";
	}else{
		var clusterName = "Pending..."//document.getElementById("cluster_name").value;
		var clusterType = document.getElementById("cluster_type").value; //document.getElementById("cluster_type").options[document.getElementById("cluster_type").selectedIndex].text;
		var clusterTypeName = document.getElementById("cluster_type").value;
		var platform = document.getElementById("platform").value;
		//var templateId = document.getElementById("templates").value;
		var templateName = "Peding..."//document.getElementById("templates").options[document.getElementById("templates").selectedIndex].text
		var credentialId = ""//document.getElementById("credentials").value;
		var targetBucket = null;
		var sourceClusterId = null;
		var sourceDatasetName = null;
		var sharedServicesIp = null;
	}
		
	var ambariServerIp = "PENDING"
	var gateway = null
	
	console.log("/deployPackage?clusterType="+clusterType+"&platform="+platform+"&credentialId="+credentialId+"&sharedServicesCluster="+encodeURIComponent(sourceClusterName)+"&targetBucket="+encodeURIComponent(targetBucket)+"&sourceClusterId="+encodeURIComponent(sourceClusterId)+"&sourceDatasetName="+encodeURIComponent(sourceDatasetName));
	var url = "/deployPackage?clusterType="+clusterType+"&platform="+platform+"&credentialId="+credentialId+"&sharedServicesCluster="+encodeURIComponent(sourceClusterName)+"&targetBucket="+encodeURIComponent(targetBucket)+"&sourceClusterId="+encodeURIComponent(sourceClusterId)+"&sourceDatasetName="+encodeURIComponent(sourceDatasetName)
	
	var valid = true
	if(isEphemeral || isClusterNameValid()){
		if(clusterType == 'shared-services' || clusterType == 'dps-managed'){
			if(rds[dpsPlatform] !=  null){
				valid = true
			}else{
				valid = false
				alert("There is no RDS Service deployed in the selected Cloud Platform. Deploy RDS Service cluster type to the selected Cloud Platform to enable DPS Managed and Datalake services")
			}
		}else{
			valid = true	
		}
	}else{
		valid = false
		alert("Cluster Name must be at least 5 characters in length and not contain characters other than a-z, 0-9, -")	
	}
	
	if(valid){
		console.log(url);
		$.get(url, function(data) {
			console.log(data);
			paintCluster(data.id, data.name, clusterTypeName, data.status, platform, templateName, ambariServerIp, gateway)
		});

		document.getElementById('form_container').style.display = 'none'
		document.getElementById('ephemeral_form_container').style.display = 'none'
		//document.getElementById("ephemeral_cluster_name").value = "ephemeral"+Math.floor((Math.random() * 10000) + 1)
	}
}

function terminateCluster(clusterId){
	var url = "/terminateCluster?clusterId="+clusterId
	$.get(url, function(data) {
		console.log(data);
	});		
}

function paintCluster(clusterId, clusterName, clusterType, clusterStatus, platform, templateName, ambariServerIp, gateway){
	
	var clusterHTML = '<div id="cluster'+clusterId+'" class="cluster" style="float: left; display: block; padding-top: 10px; padding-right: 10px;padding-bottom: 10px; padding-left: 10px;">' +
	  '	 <div class="cluster" style="font-size: 14px; float: left; width:310px; height: 205px; box-shadow: 1px 2px 5px 0 rgba(0,0,0,0.2);background-color: white;">' +
	  '  	<div class="cluster-header" style="background: #456b7e; color: #fff; height: 60px;">' +
	  '			<div style="margin: 0px;"><span class="label label-info ng-binding" style="float: right;">'+platform+'</span></div>' +
	  '			<div class="cluster-title" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis; padding-left: 10px" id="cluster-'+clusterName+'">' +
	  '				<i class="fa fa-fw fa-server" aria-hidden="true"></i> '+clusterName +
	  '			</div>' +
	  '			<div class="cluster-ambari-ip" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis; padding-left: 10px" id="cluster-'+clusterName+'">' +
	  '				<i class="fa fa-fw fa-desktop" aria-hidden="true"></i> '+ambariServerIp +
	  '			</div>' +
	  '			<div class="cluster-status" style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis; padding-left: 7px" id="cluster-'+clusterName+'">' +
	  '				<i class="fa fa-fw fa-lg fa-check-circle" aria-hidden="true"></i> '+clusterStatus +
	  '			</div>' +
	  '	 	</div>' +
	  '	<div class="cluster-summary-row" style="padding-left: 10px">' +
	  '		<div class="cluster-summary-col">' +
	  '			<h5>Type</h5> '+clusterType +
	  '	 	</div>' +
	  '	</div>	' +
	  '	<div class="cluster-summary-row" style="padding-left: 10px">' +
	  '		<div class="cluster-summary-col">' +
	  '			<h5>Node Size</h5> ' + templateName +
	  '		</div>' +
	  '	</div>'+
	  '	<div class="cluster-summary-row" style="padding-left: 10px; width: 300px;">' +
	  '		<div class="cluster-summary-col">' +
	  '			<h5 class="card-list-title">';
	  
	  if(ambariServerIp == ''){
		  clusterHTML = clusterHTML + 
	  '		<div class="cluster-summary-col">' +
	  '			<h5 class="card-list-title">';
      '  		<div class="dropdown" id="clusteraction_dropdown" style="float: left;">' +
      '      		<button class="btn btn-default dropdown-toggle" type="button" id="dropdownButton01" style="border-color: #456b7e; color: #456b7e;" data-toggle="modal" aria-haspopup="true" aria-expanded="false">' +
      '          		Actions<span class="caret"></span>' +
      '      		</button>' +
      '     			<ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownButton01" id="cluster-actions">' +
      '          		<li class="ng-scope" style="height: 30px; " onclick="terminateCluster('+clusterId+')">' +
      '					<a href="" class="" role="button" id="terminate">' +
      '					<i class="fa fa-fw fa-external-link" aria-hidden="true"></i>Terminate</li>' +
      '     			</ul>' +
      '  		</div>' +
      '	    		</h5>'
	  '		</div>' +
	  '	</div>'
	  }
	
	if(ambariServerIp == ''){
		clusterHTML = clusterHTML + 
		  '	<div class="cluster-summary-row" style="padding-left: 10px">' +
		  ' 	   <div class="cluster-summary-col">' +
	      ' 	      <h5 class="card-list-title">' +
	      '  		<div class="dropdown" id="clusteruis_dropdown" style="float: right;">' +
	      '      		<button class="btn btn-default dropdown-toggle" type="button" id="dropdownButton02" style="border-color: #456b7e; color: #456b7e;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">' +
	      '          		Cluster UIs<span class="caret"></span>' +
	      '      		</button>' +
	      '     			<ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownButton02" id="cluster-services">' +
	      '          		<li class="ng-scope"><a href="https://'+ambariServerIp+'/'+clusterName+'/services/ambari/" class="" role="button" target="_blank">' +
	      '						<i class="fa fa-fw fa-external-link" aria-hidden="true"></i>Ambari Web</a></li>' +
	      '          		<li class="ng-scope"><a href="https://'+ambariServerIp+'/'+clusterName+'/services/ambari/#/main/views/HIVE/2.0.0/AUTO_HIVE20_INSTANCE" role="button" target="_blank" class="ng-binding">' +
	      ' 						<i class="fa fa-fw fa-external-link" aria-hidden="true"></i>Hive View 2.0</a></li>' +
	      '     			</ul>' +
	      '  		</div>' +
	      '	       </h5>'  +
		  '		</div>' +
		  '	</div>';
	}
	
	clusterHTML = clusterHTML + 
	'	<div class="cluster-summary-row" style="padding-left: 10px">' +
	' 	   <div class="cluster-summary-col">' +
    ' 	      <h5 class="card-list-title">' +
	'			  <div class="modal." style="float: right;">' +
	'			    <button type="button" class="btn btn-default" style="border-color: #456b7e; color: #456b7e;" data-toggle="modal" data-target="#modal-'+clusterName+'"">Cluster Details</button>' +
	'			    <div class="modal fade" id="modal-'+clusterName+'" role="dialog">' +
	'			      <div class="modal-dialog">' +
	'			        <div class="modal-content">' +
	'			          <div class="modal-header">' +
	'			            <button type="button" class="close" data-dismiss="modal">&times;</button>' +
	'			            <h4 class="modal-title">'+clusterName+'</h4>' +
	'			          </div>' +
	'			          <div class="modal-body">';
		var sharedServiceClusterName = document.getElementById('shared_services_cluster_name').value
		var dpsClusterName = document.getElementById('dps_cluster_name').value
		count = 0;
		for (var service in gateway) {
			if(gateway[service] != null){
				clusterHTML = clusterHTML + 
				'	<li class="ng-scope"><a href="'+gateway[service]+'" class="" role="button" target="_blank">' +
    				'	<i class="fa fa-fw fa-external-link" aria-hidden="true"></i>'+service+'</a></li>';
				count++;
			}
		}
		if(count == 0){
			if(clusterName == dpsClusterName){
				clusterHTML = clusterHTML +
				'	<li class="ng-scope"><a href="https://'+ambariServerIp+'" class="" role="button" target="_blank">' +
				'	<i class="fa fa-fw fa-external-link" aria-hidden="true"></i>DataPlane Service</a></li>';
			}else{
				clusterHTML = clusterHTML +
				'	<li class="ng-scope"><a href="https://'+ambariServerIp+'/ambari" class="" role="button" target="_blank">' +
				'	<i class="fa fa-fw fa-external-link" aria-hidden="true"></i>Ambari</a></li>';
			}
		}else{
			if(clusterName != sharedServiceClusterName && clusterName != dpsClusterName){
				clusterHTML = clusterHTML + 
				'	<li class="ng-scope"><a href="https://'+ambariServerIp+':30800" class="" role="button" target="_blank">' +
    				'	<i class="fa fa-fw fa-external-link" aria-hidden="true"></i>Data Analytics Studio</a></li>';
			}
		}
	clusterHTML = clusterHTML +
	'			          </div>' +
	'			          <div class="modal-footer">' +
	'			          	<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>' +
	'			          </div>' +
	'			        </div>' +			        
	'			      </div>' +
	'			   </div>' +
	'			</div>' +
    '         </h5>'  +
	'      </div>' +
	'	</div>';
	clusterHTML = clusterHTML + '</div>';
	
	$("#clusters").append(clusterHTML);
}

function clearSelect(selectbox)
{
    var i;
    for(i = selectbox.options.length - 1 ; i >= 0 ; i--)
    {
        selectbox.remove(i);
    }
}

</script>

<script>
    $(document).ready(function(){

        $('#jstree1').jstree({
            'core' : {
                'check_callback' : true
            },
            'plugins' : [ 'types', 'dnd' ],
            'types' : {
                'default' : {
                    'icon' : 'fa fa-folder'
                },
                'html' : {
                    'icon' : 'fa fa-file-code-o'
                },
                'svg' : {
                    'icon' : 'fa fa-file-picture-o'
                },
                'css' : {
                    'icon' : 'fa fa-file-code-o'
                },
                'img' : {
                    'icon' : 'fa fa-file-image-o'
                },
                'js' : {
                    'icon' : 'fa fa-file-text-o'
                }

            }
        });


    });
</script>

<script>
								
$(function () {
	var to = false;
	$('#demo_q').keyup(function () {
		if(to) { clearTimeout(to); }
		to = setTimeout(function () {
			var v = $('#demo_q').val();
			$('#using_json').jstree(true).search(v);
		}, 250);
	});
});
						
</script>

</html>
